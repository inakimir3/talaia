---
import { useTranslations, getLocalizedRoute, translatePath } from "../i18n/utils";
import { languages } from "../i18n/ui";

const currentLang = Astro.currentLocale || "es";
const translateLabels = useTranslations(currentLang as keyof typeof languages);

const localizedLink = (path: string) => {
  if (currentLang === "es") return path;
  return `/${currentLang}${path}`; 
};

// ===== Helper cambio idioma =====
const currentPath = Astro.url.pathname;

const pathWithoutLang = currentLang === "es"
  ? currentPath
  : currentPath.replace(`/${currentLang}`, "");

const getLangUrl = (lang: "es" | "en") => {
  const translatedPath = translatePath(currentPath, lang);

  if (lang === "es") return translatedPath;
  return `/${lang}${translatedPath === "/" ? "" : translatedPath}`;
};

---

<header id="site-header" class="fixed w-full top-0 left-0 z-50 px-5 lg:px-10 py-5 transition-colors duration-300">
    <article class="w-full flex items-center justify-between">
        <a href={localizedLink("/")}>
            <img
                id="header-logo"
                src="/images/logo-talaia-white.svg"
                data-logo-white="/images/logo-talaia-white.svg"
                data-logo-dark="/images/logo-talaia.svg"
                alt="Logo de Talaia"
                class="h-24 w-auto transition-all duration-300"
            />
        </a>

        <nav class="flex items-center gap-6 header-nav">
            <a href="https://wa.me/34666332384" target="_blank" class="hidden lg:flex header-phone px-4 rounded-full py-3 items-center gap-2 transition duration-300">
                <i class="fa-solid fa-phone fa-sm"></i>
                <span>+34 666 332 384</span>
            </a>

            <div id="menu-btn" class="c-btn z-50">
                <i class="fa-solid fa-bars-staggered fa-lg c-icon"></i>
            </div>
        </nav>
    </article>
</header>

<!-- ===== MOBILE MENU ===== -->
<div id="mobile-menu" class="fixed top-0 right-0 h-dvh w-full lg:w-fit px-5 lg:px-20 bg-[#5c6d9b] z-60 translate-x-full transition-transform duration-500 ease-in-out">

    <div class="absolute top-10 right-10">
        <div id="close-menu-btn" class="c-btn c-btn--light">
            <i class="fa-solid fa-xmark fa-lg c-icon"></i>
        </div>
    </div>

    <nav class="h-full flex flex-col items-center lg:items-start justify-center gap-8 text-white text-4xl font-light">

        <a href={getLocalizedRoute("reservas", currentLang)} class="hover:opacity-60 transition">
            {translateLabels("header.bookings")}
        </a>

        <a href="https://wa.me/34666332384" target="_blank" class="hover:opacity-60 transition">
            {translateLabels("header.contact")}
        </a>

        <a href="https://www.instagram.com/talaiacharter/" target="_blank" class="hover:opacity-60 transition">
            Instagram
        </a>

        <!-- ===== Selector idioma ===== -->
            {Object.entries(languages)
            .filter(([lang]) => lang !== currentLang)
            .map(([lang]) => (
                <a
                    href={getLangUrl(lang)}
                    class="py-2  text-white  transition hover:opacity-60 mt-6 text-3xl"
                >
                    {lang === "es" ? "Español" : lang === "en" ? "English" : lang}
                </a>
        ))}

    </nav>
</div>

<style>
#site-header {
    background: transparent;
    height: fit-content;
    transition: background 0.3s, height 0.3s, padding 0.3s;
}

#header-logo {
    height: 96px;
    transition: height 0.3s;
}

.header-nav {
    gap: 24px;
    transition: gap 0.3s;
}

.header-phone {
    background: white;
    color: black;
    transition: 0.3s;
}

.header-phone:hover {
    background: #5c6d9b;
    color: white;
    transform: scale(1.05);
}

#site-header.scrolled {
    background: white;
    @media screen and (max-width: 1024px) {
        padding: 10px 20px;
    }
}

#site-header.scrolled #header-logo {
    @media screen and (max-width: 1024px) {
        
        height: 64px;
    }
}

#site-header.scrolled .c-btn {
    @media screen and (max-width: 1024px) {
        
        width: 40px;
        height: 40px;
    }
}

.c-btn {
    width: 48px;
    height: 48px;
    background: #5c6d9b;
    color: white;
    border-radius: 9999px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: 0.3s;
}

.c-btn--light {
    background: white;
    color: black;
}

@keyframes forward {
    0%{transform:translateX(0);opacity:1}
    40%{transform:translateX(120%)}
    41%{transform:translateX(-120%);opacity:0}
    100%{transform:translateX(0);opacity:1}
}

@keyframes back {
    0%{transform:translateX(0);opacity:1}
    40%{transform:translateX(-120%)}
    41%{transform:translateX(120%);opacity:0}
    100%{transform:translateX(0);opacity:1}
}
</style>

<script>
const header = document.getElementById('site-header');
const logo = document.getElementById('header-logo');

const logoWhite = logo.dataset.logoWhite;
const logoDark = logo.dataset.logoDark;

const segments = window.location.pathname.split('/').filter(Boolean);
const isHome = segments.length === 0 || (segments.length === 1 && segments[0] === 'en');

if (isHome) {
    window.addEventListener('scroll', () => {
        if (window.scrollY > 100) {
            header.classList.add('scrolled');
            logo.src = logoDark;
        } else {
            header.classList.remove('scrolled');
            logo.src = logoWhite;
        }
    });
} else {
    header.classList.add('scrolled');
    logo.src = logoDark;
}

const menuBtn = document.getElementById('menu-btn');
const closeBtn = document.getElementById('close-menu-btn');
const mobileMenu = document.getElementById('mobile-menu');

function openMenu() {
    mobileMenu.classList.remove('translate-x-full');
    mobileMenu.classList.add('translate-x-0');
    document.body.classList.add('overflow-hidden');
}

function closeMenu() {
    mobileMenu.classList.add('translate-x-full');
    mobileMenu.classList.remove('translate-x-0');
    document.body.classList.remove('overflow-hidden');
}

menuBtn.addEventListener('click', openMenu);
closeBtn.addEventListener('click', closeMenu);

// cerrar menú al hacer click en links
document.querySelectorAll('#mobile-menu a').forEach(link => {
    link.addEventListener('click', closeMenu);
});
</script>
